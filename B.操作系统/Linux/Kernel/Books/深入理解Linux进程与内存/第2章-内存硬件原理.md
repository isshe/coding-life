# CPU 硬件原理

## 问题

- 内存的内部物理结构是什么样的？
- 怎么理解内存的主频，它代表内存一秒能工作的次数吗？
- 内存的 CL、tRCD、tRP 这几个参数的含义是什么？
- 内存存在随机 IO 比顺序 IO 访问要慢的情况吗
- 如何查看内存核心频率等信息？
- 什么是内存 Bank Group？
- 什么是核心频率？什么是时钟频率？什么是数据频率？
- ECC 内存是什么？ECC 内存的原理是什么？
- ECC 内存的 8 个校验位的位置是固定的吗？如果是，通常是在什么位置？为什么？
- 什么是 chip 什么是 rank？

## 查看内存信息

```bash
cat /proc/meminfo

dmidecode | grep -A16 'Memory Device'
```

## 核心频率

核心频率是内存电路的震荡频率，是内存一下工作的基石。

## DIMM 是什么？DIMM 分类？

DIMM：Dual In-Line Memory Module，双列直插式内存模块。

> TODO

- UDIMM：无缓冲双列直插式内存模块
- SO-DIMM：小型双列直插式内存模块，笔记本内存。
- RDIMM：带寄存器双列直插式内存模块，引入寄存器时钟驱动芯片。
- LRDIMM：低负载双列直插式内存模块，引入寄存器时钟驱动芯片 + 数据缓冲器。

## 草稿

内存真正的工作频率是核心频率，时钟频率和数据频率都是核心频率的基础上，通过技术手段放大出来的，内存越新，放大倍数越大。

## ECC 内存原理

### 奇偶校验

原理：

优劣：

- 只能发现 1 bit 翻转
- 2 bit 翻转无能为力

### 海明码校验

原理：

优劣：

- 能发现并纠正 1 bit 翻转
- 能发现 2 bit 翻转
- 3 bit 翻转无能为力

### 拓展：LDPC 码

原理：

优劣：
- 能发现并纠正多 bit

## 内存硬件的内部结构

> 可参考视频：https://www.bilibili.com/video/BV1Htr8YhELV/?spm_id_from=333.337.search-card.all.click&vd_source=185d548ce5c7f87febeb849f042bd47c

概念关系图：

```
+---------------------+
|       Channel       |  (64/128 bit 总线)
+---------------------+
|       Rank 0        |  (由多个 Chip 组成)
| +-----------------+ |
| |      Chip 0     | | → 8-bit 位宽
| |  +------------+ | |
| |  |  Bank 0~7  | | |
| |  +------------+ | |
| +-----------------+ |
|         ...         |
| +-----------------+ |
| |      Chip 7     | |
| +-----------------+ |
+---------------------+


字线0-------+
      +----|---------------+
    +-|-[ 晶体管 ] -- [电容] |
    | |    （存储单元）      |
    | +--------------------+
    |
   位线
```

- Cell：存储单元，由一个晶体管和一个电容组成，电容存 0、1。晶体管控制访问。
- Bank：由存储单元组成的二维矩阵；Bank 的宽度（列数）在物理上通常远大于总线位宽（例如 1024）。
- Chip：内存颗粒，由一层一层 Bank 组成。内存条上每个内存颗粒就是 1 个 chip
- Rank：多个 chip 组成一个 Rank，每个 Rank 一次可以并发读写 64 bit 或 72 bit（ECC 内存）。
- 内存条上的 2R x 8 标识表示：内存有 2 个 Rank，每个 chip 位宽是 8 bit。每个 Rank 有 64 / 8 = 8 个颗粒（chip），2 个 Rank 就 16 个颗粒（chip）。
  - 对于位宽 4 bit 的颗粒，16 个颗粒组成一个 Rank
  - 对于位宽 8 bit 的颗粒，8 个颗粒组成一个 Rank
  - 对于位宽 16 bit 的颗粒，4 个颗粒组成一个 Rank
- 位线（bitline）：与存储单元直接连接，用于读书写入电容数据。
- 字线（wordline）：控制存储单元晶体管，由于控制访问哪些