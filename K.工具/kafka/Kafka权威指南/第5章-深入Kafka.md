[TOC]


第五章 深入 Kafka
---

# 概念
* 控制器：就是一个 broker，但是还负责分区首领的选举。
。

# 一个集群有几个控制器？控制器是如何确定的？
* 一个集群一个控制器；
* 集群里第一个启动的 broker 通过在 Zookeeper 里创建一个临时节点`/controller`让自己成为控制器。
* 其他 broker 启动时也尝试创建这个节点，但是会得到`节点已存在`的异常。这些 broker 会在控制器节点上创建 Zookeeper watch 对象，以接收这个节点的变更通知。

# 什么是首领副本，什么是跟随者副本，各自有哪些职能？
* **分区**副本类型：`首领副本`、`跟随者副本`。
* `首领副本`：
  * 处理所有生产者/消费者的请求。（保证一致性）
  * 搞清楚哪个跟随者状态与自己一致。（根据偏移量可知跟随者复制进度）
* `跟随者副本`：
  * 不处理客户端的请求；
  * 唯一任务：从首领副本那里复制消息，保持与首领一致的状态。

# Kafka 如何进行复制？
* `跟随者副本`像消费者一样到`首领副本`请求消息。

# Kafka 如何处理来自生产者和消费者的请求？
* 所有的请求都是由`首领副本`来处理，`跟随者副本`进行同步。

# Kafka 的存储细节，比如文件格式和索引？

# Kafka 使用的零复制技术是什么？

# Kafka 的请求类型有哪些？
* 元数据请求：获取分区的元数据信息（分区首领等）；
* 生产请求：生产者发送来的写入请求；
* 获取请求 (消费请求)：消费者发来的读取请求；

# 怎样才算同步？同步需要满足什么条件？
* 与 Zookeeper 之间有一个活跃的会话——过去 6s（可配置）内向 Zookeeper 发送过心跳。
* 在过去 10s（可配置）内从首领那里获取过消息；
* 在过去 10s 内从首领那里获取过最新的消息。
  * 光从首领那里获取消息是不够的，它还必须是几乎零延迟的。